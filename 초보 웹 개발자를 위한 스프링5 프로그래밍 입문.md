# 초보 웹 개발자를 위한 스프링5 프로그래밍 입문

### 사전준비

- Window > Preferences > General > Workspace에서 Text file encoding을 UTF-8로 한다.
- [실습파일](https://github.com/madvirus/spring5fs)
- 메이븐 프로젝트 임포트: File-Import... / Maven-Existing Maven Projects
  - 최초 임포트시 관련 모듈을 다운로드한다.



## Chapter 1 들어가며

- 스프링 프레임워크의 주요 특징: 의존주입(Dependency Injection) 지원 / AOP(Aspect-Oriented Programming) 지원 / MVC 웹 프레임워크 제공 / JDBC, JPA 연동, 선언적 트랜잭션 처리 등 DB연동 지원
- 스프링 프레임워크로 웹 어플리케이션을 개발할 때 프레임워크 외에 여러 관련 프로젝트를 함께 사용한다
  - 스프링 데이터: 적은 양의 코드로 데이터 연동. JPA, 몽고DB, 레디스 등
  -  스프링 시큐리티: 인증, 인가 관련. 웹 접근 제어, 객체 접근제어, 암호화 등
  - 스프링 배치: 로깅/추적, 작업 통계, 실패 처리 등
- 스프링의 핵심 모듈은 스프링 프레임워크에 포함되지 않은 다른 모듈을 필요로 한다. 각 모듈은 메이븐 중앙 리포지토리를 통해 배포된다. 자바 프로젝트 구성에 주로 사용하는 빌드 도구인 메이븐, 그레이들(Gradle)은 둘 다 메이븐 리포지토리를 지원한다.
  - maven을 다운로드한 후 C:\devtool처럼 찾기 쉬운 곳에 압축을 풀고 환경변수 사용자 변수 Path에 bin 위치를 추가한다.
  - 명령 프롬프트에 mvn -version을 입력해 설치를 확인한다.
  - 메이븐은 JAVA_HOME 환경변수를 사용하므로 올바르지 않으면 에러메세지가 출력된다.
  - 이클립스만 이용하면 직접 설치하지 않아도 되지만 웹 어플리케이션 개발할 때 톰캣 없이 간단한 메이븐 설정만으로 실행할 수 있다. 
  - 그레이들 설치: 메이븐 설치와 같은 과정을 거친다.



## Chapter 2 스프링 시작하기

- 스프링을 이용한 자바 프로젝트 진행 과정: 메이븐(또는 그레이들)프로젝트 생성 - 이클립스에서 메이븐 프로젝트 임포트 - 스프링에 맞는 자바 코드와 설정 파일 작성 - 실행



#### maven

- 실습을 위해 만든 프로젝트의 하위 폴더에 src\main\java 를 생성한다. 자바 소스 폴더
- 프로젝트 폴더에 pom.xml 파일을 작성한다.

```xml
...
	<artifactId>sp5-chap02</artifactId>  <!-- 프로젝트 식별자 지정 -->
...
	<!-- 5.0.2 RELEASE 버전의 spring-context 모듈을 사용한다. 의존 설정 -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
...
			<!-- 1.8버전을 기준으로 자바 소스를 컴파일하고 결과 클래스를 생성. 
 				 자바 컴파일러가 소스 코드를 읽을 때 사용할 인코딩 UTF-8 -->
            <plugin>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.7.0</version>
                <configuration>
                    <source>1.8</source>
                    <target>1.8</target>
                    <encoding>utf-8</encoding>
                </configuration>
            </plugin>
```

- 메이븐 프로젝트 핵심은 pom.xml이다. 모든 메이븐 프로젝트는 프로젝트 루트 폴더에 pom.xml 파일을 갖는다. 메이븐 프로젝트에 대한 설정 정보를 관리하는 파일로 프로젝트에서 필요한 의존 모듈이나 플러그인 설정을 담는다. 
  - 메이븐은 한 개의 모듈을 **아티팩트**라는 단위로 관리한다. 위에서 spring-context라는 아티팩트에 대한 의존을 추가한 것이다. 
  - 의존 추가: 자바 어플리케이션에서 클래스 패스에 spring-context 모듈을 추가한다는 것
  - 각 아티팩트의 완전한 이름은 `아티팩트이름-버전.jar`이므로, 메이븐 프로젝트 소스 코드를 컴파일하고 실행할 때 클래스 패스에 spring-context-5.0.2.RELEASE.jar 파일을 추가한다.
  - 메이븐은 코드를 컴파일하거나 실행할 때 <dependency>로 설정한 아티팩트 파일을 사용한다. 
    - 먼저 메이븐 로컬 리포지토리에서 그룹ID\아티팩트ID\버전 폴더에 아티팩트ID-버전.jar 형식의 이름을 갖는 파일이 있는지 검사해 사용한다.
    - 로컬에 파일이 없다면 메이븐 원격 중앙 리포지토리에서 해당 파일을 다운로드한 후 로컬에 복사해 사용한다.
    - 메이븐은 기본적으로 사용자홈폴더\ .m2\repository 폴더를 로컬 리포지토리로 사용한다.
  - 프로젝트 폴더로 이동해 mvn compile명령을 실행한 후 아티팩트 파일이 생성된 것을 확인할 수 있다.
- 의존 전이(Transitive Dependencies): 처음 컴파일을 실행하면 다양한 추가 아티팩트가 다운로드 되는 걸 볼 수 있다. 컴파일 수행에 필요한 메이븐 컴파일러 플러그인같은 메이븐 관련 파일과 `의존`에서 설장한 아티팩트가 `다시 의존`하는 파일도 포함된다. spring-context-5.0.2.RELEASE.jar 파일 다운로드 전  spring-context-5.0.2.RELEASE.pom을 다운로드에 이 곳에 포함된 의존 아티팩트를 함께 다운로드 하는 것이다. 그리고 그 의존한 아티팩트가 또다시 의존하는 아티팩트가 있다면 함께 다운로드한다. 
- 메이븐 기본 폴더 구조
  - src\main\java: 자바 소스 코드 위치
  - src\main\resources: XML, 프로퍼티 파일같이 자바 소스 이외의 다른 자원 파일
  - 위의 두 개는 프로젝트 소스로 사용된다.
  - src\main\webapp: 웹 어플리케이션 개발에 사용되는 기준 폴더. JSP 소스 코드나 WEB-INF\web.xml



#### gradle

- 그레이들 프로젝트 생성: pom.xml대신 build.gradle 파일을 작성한다.

```gradle
apply plugin: 'java'

sourceCompatibility = 1.8
targetCompatibility = 1.8
compileJava.options.encoding = "UTF-8"

repositories {
	mavenCentral()     // 의존 모듈을 메이븐 중앙 리포지토리에서 다운로드
}

dependencies {
	compile 'org.springframework:spring-context:5.0.2.RELEASE'
}

// 그레이들 래퍼 설정. 소스 공유시 그레이들 설치 없이 그레이들 명령어 실행할 수 있는 래퍼 생성
task wrapper(type: Wrapper) {
	gradleVersion = '4.4'   
}
```

- 루트 폴더에서 gradle wrapper를 실행한다.
  - 내가 받은 graldeVersion은 7이상으로 책과 다른 점이 있다.
  - compile은 deprecate되어 implementation으로 대체되었다.
  - task Wrapper(type: Wrapper) 역시 wrapper로 대체되었다.
- 실행에 성공하면 gradlew.bat, gradlew, gradle폴더가 생긴다. 윈도우와 리눅스에서 사용할 수 있는 실행 파일로 gradle 명령어 대신 사용하는 래퍼 파일이다. 생성한 래퍼 파일을 이용해 설치없이 그레이들 명령어를 실행한다.
  - gradle wrapper --gradle-version 7.4.2: Gradle wrapper 빌드
  - ./gradlew build: 코드 빌드해 래퍼 실행
  - 오류나서 대신 수행한 것



- 실습(src/main/java/chap02)
  - Greeter.java: 콘솔에 메세지를 출력하는 자바 클래스
  - AppContext.java: 스프링 설정 파일
  - Main.java: main() 메서드를 통해 스프링과 Greeter를 실행하는 자바 클래스

AppContext.java

- 빈(Bean) 객체: 스프링이 생성하는 객체. 

```java
package chap02;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration  // 해당 클래스를 스프링 설정 클래스로 지정
public class AppContext {
	
    // 스프링 객체를 생성하고 초기화하는 설정. 애노테이션을 메서드에 붙이면 해당 메서드가 생성한 객체를 스프링이 관리하는 빈 객체로 등록한다.
    // 메서드의 이름은 빈 객체를 참조할 때 사용.
	@Bean
	public Greeter greeter() {          // 빈 객체에 대한 정보를 담은 메서드.
		Greeter g = new Greeter();      // 빈 애노테이션을 붙인 메서드는 객체를 생성하고
		g.setFormat("%s, 안녕하세요!");  // 알맞게 초기화 해야한다. 
		return g;
	}
}
```



Main.java

```java
package chap02;

// 이 클래스는 자바 설정에서 정보를 읽어와 빈 객체를 생성하고 관리. xml파일이나 그루비 설정 코드를 이용해 객체 생성/초기화 하는 클래스도 존재한다.
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class Main {
	public static void main(String[] args) {
        // 객체 생성할 때 앞서 작성한 AppContext 클래스를 생성자 파라미터로 전달. AppContext의 		    @Bean 설정 정보를 읽어와 Greeter를 생성하고 초기화
		AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext(AppContext.class);
        // getBean: 생성한 빈 객체 검색에 사용. (메서드 이름인 빈 객체 이름, 검색할 빈 객체 타입)
        // 앞서 greeter의 리턴 타입이 Greeter이므로 이걸 리턴한다.
		Greeter g = ctx.getBean("greeter", Greeter.class);
		String msg = g.greet("스프링");
		System.out.println(msg);
		ctx.close();
	}
}
```



- 스프링의 핵심 기능은 `객체를 생성하고 초기화`하는 것이다. 이와 관련된 기능이 ApplicationContext 인터페이스에 정의되어 있고 AnnotationConfigApplicationContext클래스가 구현했다. 
- AnnotationConfigApplicationContext 클래스의 계층도 가장 위에는 BeanFactory인터페이스가 존재하고 세번째에 ApplicationContext가 위치한다.
- BeanFactory 인터페이스: 객체 생성과 검색 기능 정의. 생성된 객체를 검색할 때 필요한 getBean() 메서드가 정의되어 있다. 싱글톤/프로토타입 빈인지 확인하는 기능도 제공한다.
- ApplicationContext 인터페이스: 메시지, 프로필/환경 변수 등을 처리할 수 있는 기능 추가 정의. 
- 위의 두 인터페이스는 빈 객체의 생성, 초기화, 보관, 제거 등을 관리하고 있어 **컨테이너**라고도 부른다. 스프링 컨테이너는 내부적으로 빈 객체와 이름을 연결하는 정보를 갖는다. 

- 자바, xml, 그루비 중 어떤 구현 클래스를 사용해도 각 구현 클래스는 설정 정보로부터 빈이라고 불리는 객체를 생성하고 그 객체를 내부에 보관한다. 그리고 getBean() 메서드를 실행해 해당하는 빈 객체를 제공한다.
- 위의 메인 코드에서 ctx.getBean으로 두 개의 빈 객체를 각각의 변수에 할당하면 같은 객체로 여겨진다. getBean이 같은 객체를 리턴하는 것인데 별도 설정 없으면 스프링은 `한 개의 빈 객체만을 생성`하며 `싱글톤 범위를 갖는다`라고 표현한다. 싱글톤은 단일 객체를 의미하는 단어로 기본적으로 한 개의 @Bean 애노테이션에 대해 한 개의 빈 객체를 생성한다. greeter1이라는 새로운 빈 애노테이션을 가지는 객체를 만든다면 각각의 객체를 만들 수 있다. 