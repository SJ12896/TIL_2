### 섹션 4: IAM 및 AWS CLI

- Identity and Access Management, Global Service(리전 선택 필요없음) 사용자를 생성하고 그룹에 배치한다. 계정 생성할 때 만들어지는 루트 계정이 기본으로 생성된다. 모든 권한을 가지고 있어 위험하기 때문에 계정을 생성할 때만 사용되어야 하고 그 후에는 사용하거나 공유하지 않고 별도의 관리자를 만들어 사용자를 생성한다. IAM의 사용자는 조직 내 한 사람으로 그룹으로 묶을 수 있다. `그룹은 사용자만 들어갈 수 있고 다른 그룹을 포함할 수는 없다.` 어느 그룹에도 속하지 않는 사용자도 존재할 수 있다. 또 한 명이 다수의 그룹에 속할 수 있다. 이렇게 만들어진 사용자는 AWS 계정을 사용하도록 할 수 있고 권한을 부여한다. 권한 부여는 정책(policies)이라는 JSON 문서를 지정한다(생성할 때 비주얼 에디터 사용 가능). 비용이나 보안 문제때문에 꼭 필요로 하는 것 이상의 권한을 주지 않는 `최소 권한의 원칙`을 적용한다. 정책을 그룹 레벨에서 연결해 모든 구성원에게 적용할 수 있다. 또 그룹에 속해있든지 아니든지 사용자에게 직접 연결하는 인라인 정책도 존재한다.
- IAM 대시보드에서 Users - Add Users로 사용자 생성하는데 그룹을 생성해 AdministratorAccess 정책을 연결해 admin그룹의 사용자가 계정 관리자 역할을 하게 한다. 생성 완료 후 대시보드에 aws계정 정보가 있고 로그인 url을 사용해 아까 생성한 계정으로 로그인할 수 있다. 다만 시크릿모드나 다른 웹사이트에서 로그인해야 한다.
- 구성
  - Version: 정책의 언어 버전. 보통 2012-10-17
  - Id: 식별용, 선택사항
  - Statement: 하나 이상. 시험을 위해 강조된 것은 확실히 이해하자.
    - Sid: 문장 id인 식별자로 선택사항
    - `effect`: 문장이 특정 api에 접근하는걸 허용할지 거부할지
    - `Principal`: 특정 정책이 적용될 사용자, 계정, 역할
    - `Action`: effect기반 허용, 거부 api 호출 목록
    - `Resource`: 적용될 action의 리소스 목록
    - Condition: 언제 적용될지. 선택사항
- 그룹과 사용자들의 정보 보호를 위한 방어 매커니즘. 비밀번호 정책은 Account Settings에서 변경. MFA설정은 계정 이름 클릭하고 My Security Credentials
  - 비밀번호: 특정 글자 요구, 길이, 변경 허용이나 금지, 기간 만료, 재사용 금지 등
  - 다요소 인증(MFA): 필수 사용 권장. 비밀번호 + 보안장치 함께 사용. AWS에서 옵션은 가상 MFA 장치(Google Authenticator, 휴대전화에서만 사용 가능), Authy(여러 장치 가능, 한 장치에서 토큰 여러 개 지원해 루트나 다른 사용자 계정에서 원하는 수만큼 계정과 사용자 등록 가능), Universal 2nd Factor Security Key(U2F, 범용 두번째 인자. 물리적 장치로 전자 열쇠 달린 usb같은것. 한 보안 키에서 여러 사용자 지원), Hardware Key Fob MFA Device(미국 정부 같은데서 사용하는 클라우드는 특수 키 팝이 필요.)
- AWS 접근
  - AWS Management Console: 웹 인터페이스. 비밀번호 + MFA
  - AWS CLI: access keys(자격 증명)로 보호. 모든 명령어는 aws로 시작하고 서비스 공용 api로 직접 액세스가 가능하다. 또 리소스 관리 스크립트를 개발해 일부 자동화가 가능하다.
  - AWS SDK: 애플리케이션 코드 내에서 API를 호출. access keys로 보호. 특정 언어로 된 라이브러리 집합으로 aws 서비스나 api에 프로그래밍을 위한 액세스가 가능하게 한다. 터미널 내가 아닌 애플리케이션 내에 심어두는 것. 
  -  access key는 관리 콘솔을 사용해 생성한다. 
  - access key CLI에서 사용하기: 루트 아닌 관리자 계정에서 사용자 클릭 후 Security credentials에서 액세스 키를 생성한다. cmd에서 `aws configure`를 입력 후 액세스 키 id, 비밀번호를 입력하고 가까운 리전을 선택해 생성한다. 그리고 `aws iam list-users`를 사용해 계정의 사용자를 볼 수 있다. 그런데 이후 루트계정에서 관리자 계정을 그룹에서 제거하면 웹 매니지먼트 콘솔과 cli에서 모두 권한이 없다는 메세지가 발생한다.
  - AWS에 터미널로 명령을 내리지않으면 CloudShell을 사용하면 된다. 다만 지원하는 리전이 한정되어 있다. 파일 생성 후 재시작해도 그대로 있으며 글씨 크기 조절, 테마 선택 등도 있다. 또한 파일의 다운로드, 업로드도 가능하다. 
- IAM Role: AWS 서비스 몇 개는 실행할 때 권한이 필요하므로 이를 부여하기 위해 IAM Role을 만들어야 한다. 사용자와 같지만 실제 사람이 아닌 aws 서비스에 의해 사용되도록 만들어져있다. 예를들어 EC2 인스턴스가 AWS에서 작업을 수행하기 위해 권한이 필요하므로 IAM Role을 만들어 사용한다. 
  - 관리자로 들어가 IAM 대시보드에서 roles를 클릭하고 create role을 택한다. 일반적으로 EC2, 람다 함수를 위해 사용하는데 임의로 ReadOnlyAccess권한을 택하고 이름만 정하면 바로 생성된다.
- IAM Security Tools: 계정 레벨에서는 자격 증명 보고서를 만들어 계정의 유저들의 자격 증명에 대한 리스트 보고서를 볼 수 있다. 언제 생성되었는지, 언제 마지막으로 비밀번호를 사용했는지 변경했는지 등이 보인다. 유저 레벨에서 액세스 관리자는 사용자에게 부여된 권한과 마지막으로 액세스한 시간을 볼 수 있다. 유저 레벨에서는 자신의 이름을 통해 Access Advisor에 들어가 활동 내역을 확인한다. 이를 통해 `최소 권한의 원칙`을 지킬 수 있다.